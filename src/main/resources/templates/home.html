<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Main page</title>
    <link rel="stylesheet" href="/css/healthmanage.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>

<body>

<div th:replace="fragments/navigationBar :: navbar"></div>

<div class="container">
    <div class="summary-box">
        <h2>Yesterday Summary</h2>
        <div class="summary-content">
            <div class="summary-text">
                <p>Exercise Burned: <span th:text="${burned}">0</span>kcal</p>
                <p>Food Intake: <span th:text="${intake}">0</span>kcal</p>
                <p>BMR: <span th:text="${bmr}">0</span>kcal</p>
                <p>
                    Calorie Balance:
                    <span th:text="${diff}">0</span>kcal
                    (<span th:style="${diff > 0 ? 'color:red;' : 'color:green;'}" th:text="${diff > 0 ? 'Surplus' : 'Deficit'}"></span>)
                </p>
            </div>
            <div class="summary-chart">
                <canvas id="yesterdayChart" width="250" height="250"></canvas>
                <div class="chart-center-text">
                    <span th:text="${diff}">0</span>
                    <small>kcal</small>
                </div>
            </div>
        </div>
    </div>

    <!--    圆环图chart.js脚本   -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // Controllerから渡された値をJavaScript変数に格納
        const intake = /*[[${intake}]]*/ 0;
        const exerciseBurned = /*[[${burned}]]*/ 0;
        const bmr = /*[[${bmr}]]*/ 0;
        // console.log("Chart Data:", intake, exerciseBurned, bmr);

        const yesterdayCtx = document.getElementById('yesterdayChart').getContext('2d');
        new Chart(yesterdayCtx, {
            type: "doughnut",
            data: {
                labels: ['Intake', 'Exercise', 'BMR'],
                datasets: [{
                    label: 'Calories(kcal)',
                    data: [intake, exerciseBurned, bmr],
                    backgroundColor: [
                        '#e74c3c', // Intake 红
                        '#2ecc71', // Exercise 绿
                        '#3498db'  // BMR 蓝
                    ]
                }]
            },

            // options: {
            //     title: {
            //         display: true,
            //         text: "World Wide Wine Production"
            //     }
            // }
        });
    </script>



    <div class="summary-box">
        <h2>Past 7 Days</h2>
        <div class="chart-container">
            <canvas id="past7DayChart"></canvas>
        </div>
    </div>
    <script th:inline="javascript">
        const intakeData = /*[[${intakeData}]]*/ [];
        const dateLabels = /*[[${dateLabels}]]*/ [];
        const burnedData = /*[[${burnedData}]]*/ [];
        const diffData = /*[[${diffData}]]*/ [];
        const goalAchievedData = /*[[${goalAchievedData}]]*/ [];

        const negativeBurnedData = burnedData.map(value => -value);
        // const pointStyles = goalAchievedData.map(achieved => achieved ? 'rect' : 'crossRot'); // 達成ならマル, 未達成ならバツ

        console.log("サーバから渡された日付ラベル:", dateLabels);
        console.log("サーバから渡された摂取カロリーデータ:", intakeData);

        const trendCtx = document.getElementById("past7DayChart").getContext("2d");
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: dateLabels,
                datasets: [
                    {
                        label: 'Food Intake',
                        data: intakeData,
                        fill: false,
                        borderColor: '#e74c3c',    // Intake 红
                        pointStyle: 'rect',
                        tension: 0.1
                    },
                    {
                        label: 'Burned (Exercise + BMR)',
                        data: negativeBurnedData,
                        fill: false,
                        pointStyle: 'rect',
                        borderColor: '#2ecc71',
                        tension: 0.1,
                    },
                    {
                        label: 'Calorie Balance',
                        data: diffData,
                        showLine: false,
                        fill: false,
                        pointBackgroundColor: '696969FF',
                        borderColor: '696969FF',
                        pointRadius: 6,
                        pointStyle: 'rectRot'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    // Y軸（縦軸）の設定
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Calories (kcal)'
                        }
                    },
                    // X軸（横軸）の設定
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    }
                }
            }
        })
    </script>

    <div class="summary-box">
        <h2>Recent Records</h2>
        <div class="summary-content">
            <div style="width: 50%;">
                <div th:if="${#lists.isEmpty(recentExerciseRecords)}">
                    <p>NO RECENT EXERCISE RECORDS</p>
                </div>
                <ul th:unless="${#lists.isEmpty(recentExerciseRecords)}" style="padding-left: 20px">
                    <li th:each="exercise : ${recentExerciseRecords}" style="margin-bottom: 5px;">
                        <span th:text="${#temporals.format(exercise.date, 'MM/dd HH:mm')}"></span>
                        <span th:text="${exercise.exerciseType.exerciseTypeName}"></span>
                        -<span th:text="${exercise.kilocalories}"></span>kcal
                    </li>
                </ul>
            </div>
            <div style="width: 50%;">
                <div th:if="${#lists.isEmpty(recentFoodRecords)}">
                    <p>NO RECENT FOOD RECORDS</p>
                </div>
                <ul th:unless="${#lists.isEmpty(recentFoodRecords)}" style="padding-left: 20px">
                    <li th:each="food : ${recentFoodRecords}" style="margin-bottom: 5px;">
                        <span th:text="${#temporals.format(food.date, 'MM/dd HH:mm')}"></span>
                        <span th:text="${food.foodType.foodName}"></span>
                        -<span th:text="${food.kilocalories}"></span>kcal
                    </li>
                </ul>
            </div>

        </div>
    </div>

    <div class="summary-box">
        <h2>Quick Access</h2>
<!--        <p>新建运动记录、新建饮食记录的入口链接</p>-->
    </div>
</div>

</body>



</html>